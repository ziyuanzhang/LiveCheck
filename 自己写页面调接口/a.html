<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>real-name</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/jquery-3.6.0.min.js"></script>
</head>


<body>
    <div>
        <span class="txt">名字</span>
        <input type="text" class="name">
    </div>
    <div>
        <span class="txt">身份证号</span>
        <input type="text" class="id">
    </div>
    <div>
        <button class="submit1">提交</button>
    </div>


    <div calss="btn">开始录制时，请眨眼-1- </div>
    <input class="recording" type="file" accept="video/*" capture="user" value="" />


    <script type="text/javascript">
        $(".submit1").click(function () {
            let data = {
                realName: $(".name").val(),
                certNo: $(".id").val()
            }
            $.get("http://quf17ix.nat.ipyingshe.com/loan/api/user/checkUserCertNo", data, function (e) {
                console.log("submit1:", e)
                console.log("submit1:", typeof e)
                let res = JSON.parse(e);
                // submit1: {"status":0,"msg":"输入成功","data":null},
                // submit1: {"status":1,"msg":"输入失败，请检查信息是否正确","data":null}
                if (res.status == 1) {
                    console.log("shibai")
                } else {
                    console.log("姓名:", res.msg)
                }

            })
        })
        $(".recording").change(function (e) {
            console.log("size:", (e.target.files[0].size) / 1024 / 1024)
            if ((e.target.files[0].size) / 1024 / 1024 > 5) {
                alert("超过5M了");
                $(".recording").val();
                return
            }
            const formData = new FormData();
            formData.append('file', e.target.files[0]);
            console.log('file:', formData.get('file'))
            $.ajax({
                url: 'http://quf17ix.nat.ipyingshe.com/loan/api/common/fileUpload',
                type: 'POST',
                data: formData, // 上传formdata封装的数据
                dataType: 'JSON',
                cache: false, // 不缓存
                processData: false, // jQuery不要去处理发送的数据
                contentType: false, // jQuery不要去设置Content-Type请求头
                success: function (res) { //成功回调
                    console.log("formData-res:", res)
                    if (res.status == "0") {
                        var fileUrlData = {
                            fileUrl: res.data
                        }
                        $.get("http://quf17ix.nat.ipyingshe.com/loan/api/common/linkSendTrueMan", fileUrlData,
                            function (e) {
                                console.log("huti:", e);
                                var fileUrlRes = JSON.parse(e);
                                if (fileUrlRes.status == "0") {

                                } else {
                                    alert(fileUrlRes.data)
                                }
                            })
                    } else {
                        alert("上传失败")
                    }
                }
            });



        })
    </script>
</body>

</html>